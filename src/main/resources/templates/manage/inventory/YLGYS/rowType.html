<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <title>批量设置供应商</title>
    <link rel="stylesheet" href="../../../../../../itsoftui/plugins/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../../../../../../itsoftui/plugins/bootstrap-3.3.5-dist/daterangepicker-bs3.css"  />
    <link rel="stylesheet" href="../../../../../../itsoftui/plugins/icheck/icheck.css">
    <link rel="stylesheet" href="../../../../../../common/css/indexBase.css">
    <link rel="stylesheet" href="../../../../../../itsoftui/css/itsoftui.css">
    <style>
        .table-search-menu{
            width: 100%!important;
        }
        .btnBox{
            width: 100%;
            height: 50px;
            background-color: #F8F8F8;
            border-top: 1px solid #eee;
            position: fixed;
            left: 0;
            bottom:0px;
        }
        .btnBox>div{width: 200px;height: 100%;margin:0 auto;padding-top: 10px;}
        #btn-ok{float: left;margin: 0;}
        #btn-cancel{float: right;margin: 0;}
        .datagrid-body{
            height: 317px!important;
        }
    </style>
</head>
<body>
  <div class="pd-5 wrap" style="width: 515px;">
      <div class="itsoft-panel">
          <div class="itsoft-datagrid" id="datagrid"></div>
      </div>
      <div class="btnBox">
          <div>
              <input id="btn-ok" class="btn btn-primary btn-its" type="button" value="确定">
              <input id="btn-cancel" class="btn btn-default btn-its" type="button" value="取消">
          </div>
      </div>
  </div>
</body>
<script src="../../../../../../itsoftui/plugins/jquery-1.12.4.js"></script>
<script src="../../../../../../itsoftui/plugins/layer/layer.js"></script>
<script src="../../../../../../itsoftui/plugins/icheck/jquery.icheck.min.js"></script>
<script src="../../../../../../itsoftui/plugins/moment.min.js" type ="text/javascript"></script>
<script src="../../../../../../itsoftui/plugins/bootstrap-3.3.5-dist/daterangepicker.js"  type="text/javascript"></script>
<script src="../../../../../../itsoftui/plugins/bootstrap-3.3.5-dist/date.js"  type ="text/javascript"></script>
<script src="../../../../../../itsoftui/js/itsoftui.js"></script>
<script>
    var index=parent.layer.getFrameIndex(window.name);
    $(function () {
    var datagrid= $('#datagrid').datagrid({
            keyField: "orderid",
            page:false,
            url: '../../../../../../data/order.json',
            type: 'GET',
            line: "both",
            isSequence: false,
            singleSelect: true,
            eventrow: false,
            click: function() {

            },
            dblclick: function() {
                loadPage()
            },
            columns:[
                {
                    field:'id',
                    isshow:false
                },{
                    title: '编码',
                    field: 'itemCod',
                    align: "center",
                    width: '120',
                    formatter:function () {
                        return '10123'
                    }
                },
                {
                    title: '原料类别',
                    field: 'itemName',
                    align: "center",
                    width: '100',
                    formatter:function () {
                        return '胆水板豆腐'
                    }
                },
                {
                    title: '供应商',
                    field: 'itemCGY',
                    align: "center",
                    width: '280',
                    overflow: "visible",
                    formatter:function () {
                        return '<input type="text" name="rawName" data="" value="" >' +
                               '<a class="iconfont listbtn iconfont-arrow2-bottom" data-type="1"></a>' +
                               '<div class="table-search-menu"></div>';
                    }
                }
            ]
        });
        datagrid.loadData();

        //下拉

        $('#datagrid').on('click','.listbtn',function () {
           var menu=$(this).next('.table-search-menu');
           menu.empty();
           var t;
           $(this).attr('data-type')==1?t=1:t=2;
           if(menu.is(':hidden')){
               $(document).find('.table-search-menu').hide();
               setTimeout(function () {
                   menu.show()
               },300)
           };
            //查询数据
            ITSOFT.dataAjax({
                url: '../../../../../../data/material.json',
                type: 'GET',
                data:{"type":t},
                async: true,
                beforeSend: function() {},
                success: function(res) {
                    if (res.data.length > 0) {
                        $.each(res.data, function(i, row) {
                            var $table = $("<ul class='table-search'/>");
                            //id
                            $table.append('<li  field="rawId"  style="display:none">' + row["id"] + '</li>')
                            //原料名称
                            $table.append('<li field="rawName" style="width:275px; text-align:left;"  >' + row["name"] + '</li>')
                            menu.append($table);
                        });
                    }
                },
                complete: function() {
                    $(menu).find(".loading").remove();
                },
                error: function() {
                    ITSOFT.tools.showMsg("error", "数据加载失败")
                }
            });
            $(document).on('click','ul',function () {
                var id=$(this).find('li[field=rawId]').text();
                var val=$(this).find('li[field=rawName]').text();
                $(this).parents('.table-search-menu').siblings('input').val(val)
            });



        });

        $("#btn-ok").on('click', function(event) {
            $("#addform").submit();
        });
        $("#btn-cancel").on('click', function(event) {
            parent.ITSOFT.itWin.close(index);
        });
    })
</script>
</html>