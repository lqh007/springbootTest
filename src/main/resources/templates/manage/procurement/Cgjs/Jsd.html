<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <title>新建结算单</title>
    <link rel="stylesheet" href="../../../../../../itsoftui/plugins/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../../../../../../itsoftui/plugins/icheck/icheck.css">
    <link rel="stylesheet" href="../../../../../../common/css/indexBase.css">
    <link rel="stylesheet" type="text/css" href="../../../../../../itsoftui/plugins/pikaday/pikaday.css" />
    <link rel="stylesheet" href="../../../../../../itsoftui/css/itsoftui.css">
    <style>
        .handle{
            color: #2e8ded;
            cursor: pointer;
        }
        .selectrow .handle{
            color: #fff;
        }
        .timeBtn span{
            margin-top: 0;
        }
        .table-search-menu{
            width: 660px!important;
        }
        .tip{
            color: #aa1111;
        }
    </style>
</head>
<body>
<div class="pd-10 wrap">
    <div class="wrap-top">
        <p style="color: #737373;float: left;">采购结算->新建结算单</p>
        <p id="closeBtn" style="float: right;"></p>
    </div>
    <div class="wrap-bd">
        <div class="itsoft-toolbar">
            <div id="toolBtn"></div>
            <div id="toolBtnRt" style="float: right"></div>
        </div>
        <div class="itsoft-panel">
            <div class="itsoft-panel-form">
                <form id="addform" class="form form-horizontal" action="ajaxOperation.ashx?Action=formUpload" method="post" enctype="multipart/form-data" style="width:720px">
                    <div class=" row form-group">
                        <label class=" col-md-1  control-label" style="width: 90px;">单据号：</label>
                        <div class="col-md-1 " style="width: 200px;">
                            <input type="text" name="gysname" placeholder="单据号自动生成" disabled="disabled" class="form-control">
                        </div>
                        <label class=" col-md-1  control-label" style="width: 90px;"><em class="tip">*</em>供应商：</label>
                        <div class="col-md-1 " style="width: 370px;">
                            <div id="wareHouse" class="dropdownlist" name="wareHouse">
                            </div>
                        </div>
                    </div>
                    <div class=" row form-group">
                        <label class=" col-md-1  control-label" style="width: 90px;">备注：</label>
                        <div class="col-md-1 " style="width: 660px;">
                            <input type="text" name="bz" placeholder="备注信息" class="form-control">
                        </div>
                    </div>
                    <div class=" row form-group">
                        <label class=" col-md-1  control-label" style="width: 80px;">制单人：</label>
                        <div class="col-md-1 " style="width: 150px;">
                            <input type="text" name="bz" placeholder="备注信息" class="form-control">
                        </div>
                        <label class=" col-md-1  control-label" style="width: 80px;">制单时间：</label>
                        <div class="col-md-1 " style="width: 150px;">
                            <input type="text" name="bz" value="2018-03-07" class="form-control">
                        </div>
                        <label class="col-md-1 control-label" style="width: 90px;">入库日期：</label>
                        <div class="col-md-1" style="width: 200px;">
                            <input type="text" id="gyTime" name="gyTime" placeholder="请选择供应时间" class="form-control">
                            <i class="iconfont iconfont-arrow2-bottom" style=" float:right; position: absolute; top:2px;right:20px"></i>
                        </div>
                    </div>
                </form>
                <div id="orderlog" style="position: absolute; height: 145px; overflow: auto; right: 2px;
            line-height: 25px; top: 0px; width: 410px;">
                    <p style="margin-top: 5px;">
                        <code>温馨提示:</code></p>
                    <p>
                        1.带*号为必填项目;</p>
                    <p>
                        2.审核后系统自动过账，单据锁定;</p>
                    <p>
                        3.结算时间可以推迟，但只能推迟一个账期。</p>
                </div>
            </div>
            <div class="itsoft-datagrid" style="border-top: 0">
                <div id="datagrid"></div>
            </div>

        </div>
    </div>
</div>
</body>
<script src="../../../../../../itsoftui/plugins/jquery-1.12.4.js"></script>
<script src="../../../../../../itsoftui/plugins/layer/layer.js"></script>
<script src="../../../../../../itsoftui/plugins/moment.min.js" type="text/javascript"></script>
<script src="../../../../../../itsoftui/plugins/pikaday/pikaday.js" type="text/javascript"></script>
<script src="../../../../../../itsoftui/plugins/icheck/jquery.icheck.min.js"></script>
<script src="../../../../../../itsoftui/js/itsoftui.js"></script>
<script>
    var index=parent.layer.getFrameIndex(window.name);
    var datagrid;
    $(function () {

        //关闭按钮
        $('#closeBtn').toolbarbtn({
            btn:[
                {
                    text:'',
                    title:'关闭',
                    width:'35px',
                    icon:'iconfont-close',
                    click:function () {
                        parent.ITSOFT.itWin.close(index);
                    }
                }
            ]
        });
        //按钮
        $('#toolBtn').toolbarbtn({
            btn:[
                {
                 text:'删除单据',
                 title:'删除单据',
                 width:'100px',
                 icon:'iconfont-del2',
                 click:function () {
                     
                 }   
                }
            ]
        });
        $('#toolBtnRt').toolbarbtn({
            btn:[
                {
                 text:'新单',
                 title:'新单',
                 icon:'iconfont-fabu',
                 click:function () {

                 }
                },
                {
                 text:'保存',
                 title:'保存',
                 icon:'iconfont-save',
                 click:function () {

                 }
                },
                {
                 text:'审核',
                 title:'审核',
                 icon:'iconfont-edit2',
                 click:function () {

                 }
                }
            ]
        });

        //供应商
        $('#wareHouse').dropdownlist({
            dataurl:'../../../../../../data/select.json',
            placeholder:'请选择供应商',
            width:'352px',
            'allowinput': true,
            changeEvent:function (val,text) {

            }
        });
        //直入直出
        $('#demandUnit').dropdownlist({
            dataurl:'../../../../../../data/select.json',
            placeholder:'请选择需求单位',
            width:'182px',
            changeEvent:function (val,text) {

            }
        });

        //供应时间
        var pickerydrq = new Pikaday({
            field: document.getElementById('gyTime'),
            firstDay: 1,
            format: 'YYYY-MM-DD',
            minDate: ITSOFT.tools.dateCalDay(1, 0), //today
            maxDate: ITSOFT.tools.dateCalDay(1, 30), //30days  后
            yearRange: [2010, 2020]
        });
       //列表
      datagrid = $('#datagrid').datagrid({
            keyField: "orderid",
            page:false,
            url: '../../../../../../data/order.json',
            type: 'GET',
            line: "both",
            isSequence: true,
            singleSelect: true,
            eventrow: false,
            click: function() {

            },
            dblclick: function() {

            },
            columns:[
                {
                    field:'id',
                    isshow:false
                },{
                    title: '<a title="添加行" class="iconfont listbtn addrow iconfont-add"></a>',
                    width: '30',
                    formatter: function(val, i) {
                        return '<a title="删除行" class="iconfont listbtn delrow iconfont-del"></a>';
                    }
                },
                {
                    title: '单据号',
                    field: 'rawName',
                    align: "center",
                    width: '180',
                    overflow: "visible",
                    formatter:function () {
                        return '<input type="text" name="rawName" readonly data=""  value="">' +
                               '<a class="iconfont listbtn iconfont-more"></a>' +
                               '<div class="table-search-menu"></div>';
                    }
                },
                {
                    title: '入/退库日期',
                    field: 'rawType',
                    align: "center",
                    width: '150',
                    formatter:function () {
                        return ''
                    }
                },
                {
                    title: '审核人',
                    field: 'rawUnit',
                    align: "center",
                    width: '100',
                    formatter:function () {
                        return ''
                    }
                },
                {
                    title: '原料数量',
                    field: 'rawDw',
                    align: "center",
                    width: '80',
                    formatter:function () {
                        return ''
                    }
                },
                {
                    title: '金额',
                    field: 'rawBrand',
                    align: "center",
                    width: '150',
                    formatter:function () {
                        return ''
                    }
                },
                {
                    title: '备注',
                    field: 'remark',
                    align: "left",
                    width: '100',
                    widthfix:true,
                    formatter:function () {
                        return '<input type="text" value=" ">'
                    }
                },
            ]
        });


        $('.btnop').on('click','span',function () {
            $(this).addClass('on').siblings().removeClass('on')
        });

        //点击添加行
        $("#datagrid").on("click", ".addrow", function(e) {
            addrow();
        });

        function  addrow() {

            datagrid.addRow(0, null, null);
            var row = $("#datgrid1 .table-body tr").last();
            $(row).find("input").eq(0).focus();
        }

        //更多
        $('#datagrid').on('click','.iconfont-more',function () {
            ITSOFT.itWin.open({
                title:'选择原料[1，打钩选中原料 2，点确定进行添加 3，可以多选]',
                area:['900px','500px'],
                content:['addReportRow.html','no']
            })
        });
    });
    function insertrow(data) {
        var currentrow = datagrid.getSelectedRow(); //当前行
        $.each(data, function(i, col) {
            if (i == 0) {
                //材料id
                currentrow.children("td[field='mid']").text(col["mid"]);
                //材料名称
                currentrow.children("td[field='mname']").children("input").val(col["mname"]);
                //这句话目的为了验证输入的值和选中的值
                currentrow.children("td[field='mname']").children("input").attr("data", col["mname"]);
                //材料国际码
                currentrow.children("td[field='mbarcode']").text(col["mbarcode"]);
                //材料规格
                currentrow.children("td[field='mspec']").text(col["mspec"]);
                //材料单位
                currentrow.children("td[field='munit']").text(col["munit"]);
                //材料厂家
                currentrow.children("td[field='mmanufacturers']").text(col["mmanufacturers"]);
                currentrow.attr("ischange", "1")
            } else {
                var newdata = {
                    'orderid': '0'
                }; //orderid 合并进去
                $.extend(true, col, newdata);
                currentrow = datagrid.addRow(0, null, col,currentrow);
                currentrow.attr("ischange", "1");
            }

        });

    }




</script>
</html>