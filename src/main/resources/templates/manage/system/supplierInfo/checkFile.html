<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <title>添加证书</title>
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/bootstrap/css/bootstrap.css" th:href="@{${root}+'/itsoftui/plugins/bootstrap/css/bootstrap.css'}">
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/bootstrap-3.3.5-dist/daterangepicker-bs3.css"    th:href="@{${root}+'/itsoftui/plugins/bootstrap-3.3.5-dist/daterangepicker-bs3.css'}"  />
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/webuploader-0.1.5/webuploader.css" th:href="@{${root}+'/itsoftui/plugins/webuploader-0.1.5/webuploader.css'}">
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/webuploader-0.1.5/updatefile.css" th:href="@{${root}+'/itsoftui/plugins/webuploader-0.1.5/updatefile.css'}">
    <link rel="stylesheet" href="../../../../static/itsoftui/css/itsoftui.css" th:href="@{${root}+'/itsoftui/css/itsoftui.css'}">
    <style>
        .btnBox{
            width: 100%;
            height: 50px;
            background-color: #F8F8F8;
            border-top: 1px solid #eee;
            position: fixed;
            left: 0;
            bottom:0px;
        }
        .btnBox>div{width: 200px;height: 100%;margin:0 auto;padding-top: 10px;}
        #btn-ok{float: left;margin: 0;}
        #btn-cancel{float: right;margin: 0;}
    </style>
</head>
<body>
    <div class="pd-5" style="padding-left: 20px">
        <form>
            <div class="form-group row">
                <label class="control-label">附件：</label>
                <div>
                    <div class="uploadbox">
                        <div id="advicefilelist" class="updatefilelist" >
                            <ul>
                            </ul>
                        </div>
                    </div>
                    <div id="uploadfilemore" class="uploadimg">
                        <input type="hidden" name="fileUrl" id="fileUrl" />
                        <input type="hidden" name="fileName" id="fileName" >
                    </div>
                </div>
            </div>
        </form>
    </div>
</body>
<script src="../../../../static/itsoftui/plugins/jquery-1.12.4.js" th:src="@{${root}+'/itsoftui/plugins/jquery-1.12.4.js'}"></script>
<script src="../../../../static/itsoftui/plugins/jQuery.form.js" th:src="@{${root}+'/itsoftui/plugins/jQuery.form.js'}"></script>
<script src="../../../../static/itsoftui/plugins/layer/layer.js" th:src="@{${root}+'/itsoftui/plugins/layer/layer.js'}"></script>
<script src="../../../../static/itsoftui/plugins/bootstrap-3.3.5-dist/daterangepicker.js"    th:src="@{${root}+'/itsoftui/plugins/bootstrap-3.3.5-dist/daterangepicker.js'}"  type="text/javascript"></script>
<script src="../../../../static/itsoftui/plugins/bootstrap-3.3.5-dist/date.js"  th:src="@{${root}+'/itsoftui/plugins/bootstrap-3.3.5-dist/date.js'}" type ="text/javascript"></script>
<script src="../../../../static/itsoftui/plugins/moment.min.js" th:src="@{${root}+'/itsoftui/plugins/moment.min.js'}" type ="text/javascript"></script>
<script src="../../../../static/itsoftui/plugins/webuploader-0.1.5/webuploader.js" th:src="@{${root}+'/itsoftui/plugins/webuploader-0.1.5/webuploader.js'}"></script>
<script src="../../../../static/itsoftui/plugins/webuploader-0.1.5/itsoft-uploader.js" th:src="@{${root}+'/itsoftui/plugins/webuploader-0.1.5/itsoft-uploader.js'}"></script>
<script src="../../../../static/itsoftui/plugins/jquery.imgResizeH.js" th:src="@{${root}+'/itsoftui/plugins/jquery.imgResizeH.js'}"></script>
<script src="../../../../static/itsoftui/js/itsoftui.js" th:src="@{${root}+'/itsoftui/js/itsoftui.js'}"></script>
<script>
    var index=parent.layer.getFrameIndex(window.name);
    var staticUploadUrl = '[[${staticUploadUrl}]]';
    $(function () {

        //上传照片
        $("#uploadfilemore").uploader({
            pick: "#pickerfilemore",
            list: "#fileUrl",
            type: 2,
            ismore: 1,
            server: "[[${staticUploadServerUrl}]]",
            formData: {
                system:"dining",
                compress:"yes",                     //是否需要压缩(true:压缩;false:不压缩)
                widthScale:0.5,                          //宽度缩放比例(填写0-1的保留一位的小数,不允许为0)
                heightScale:0.5,                         //高度缩放比例(填写0-1的保留一位的小数,不允许为0)
                fileType:'file'                      //高度缩放比例(填写0-1的保留一位的小数,不允许为0)
            },
            success: function (r) {
                var fileurls = $("#fileUrl").val();
                var filename = $("#fileName").val();
                if (!!fileurls) {
                    fileurls = fileurls.split(",");
                    if (fileurls.length > 0) {
                        //多文件的
                        if( filename == undefined || filename == null || filename == 0) {
                            filename = r.name;
                        } else {
                            filename += "," + r.name;
                        }
                        $("#fileName").val(filename);
//                        $("#fileName").val(r.name);
                        var $li , $delImg , $img ,
                            filename;
                        $("#advicefilelist ul").html("");
                        var fileNames = $("#fileName").val();
                        if (!!fileNames) {
                            fileNames = fileNames.split(",");
                        }
                        $.each(fileurls, function (i, o) {
                            if (fileNames.length > 0) {
                                filename = fileNames[i];
                            } else {
                                filename = r.name;
                            }
                            $li
                                = $("<li/>");
                            $delImg
                                = $('<div/>').addClass("delimg").text("×");
                            $s
                                = "<a href='[[${staticUploadUrl}]]"+o+"' download='"+filename+"'>" + filename + "</a>";
                            $li.append($delImg).append($s);
                            $("#advicefilelist ul").append($li);
                        });
                    }
                }
            }
        });

        $(document).on("mouseover", "#advicefilelist li", function () {
            $(this).find(".delimg").show();
        }).on("mouseleave", "#advicefilelist li", function () {
            $(this).find(".delimg").hide();
        }).on("click", "#advicefilelist li .delimg", function () {
            //删除
            var $li =
                $(this).parent();
            var fileurls = $("#fileUrl").val();
            var filenames = $("#fileName").val();
            if (!!fileurls && !!filenames) {
                fileurls = fileurls.split(",");
                filenames = filenames.split(",");
                if (fileurls.length > 0 && filenames.length > 0) {
                    console.log($li.index())
                    fileurls.splice($li.index(), 1);
                    filenames.splice($li.index(), 1);
                }
                fileurls = fileurls.join(",");
                filenames = filenames.join(",");
                $("#fileUrl").val(fileurls).attr("data-name", filenames);
                $("#fileName").val(filenames);
            }
            $li.remove();
        });

        loadFileList()
        function loadFileList() {
            var fileUrl = document.cookie.split(";")[0].split("=")[1];
            var fileName = document.cookie.split(";")[1].split("=")[1];
            console.log(fileUrl);
            console.log(fileName);
            var fileUrlList = fileUrl.split(',');
            var fileNameList = fileName.split(',');
            $.each(fileUrlList, function (i, o) {
                var filename = fileNameList[i];
                var $li = $("<li/>");
                // var $delImg = $('<div/>').addClass("delimg").text("×");
                var $s = "<a href='[[${staticUploadUrl}]]"+o+"' download='"+filename+"'>" + filename + "</a>";
                $li.append($s);
                $("#advicefilelist ul").append($li);
            });
        }
    });
</script>
</html>