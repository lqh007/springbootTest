<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
    <title>设置供应商</title>
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/bootstrap/css/bootstrap.css" th:href="@{${root}+'/itsoftui/plugins/bootstrap/css/bootstrap.css'}">
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/icheck/icheck.css" th:href="@{${root}+'/itsoftui/plugins/icheck/icheck.css'}">
    <link rel="stylesheet" href="../../../../static/itsoftui/css/itsoftui.css" th:href="@{${root}+'/itsoftui/css/itsoftui.css'}">
    <style>
    </style>
</head>
<body>
  <div class="wrap">
      <div class="itsoft-panel">
         <div class="itsoft-toolbar" >
             <div id="toolBtn" style="float: left"></div>
             <div id="toolSearch" style="float: right"></div>
         </div>
         <div id="datagrid"></div>
      </div>
  </div>
</body>
<script src="../../../../static/itsoftui/plugins/jquery-1.12.4.js" th:src="@{${root}+'/itsoftui/plugins/jquery-1.12.4.js'}"></script>
<script src="../../../../static/itsoftui/plugins/layer/layer.js" th:src="@{${root}+'/itsoftui/plugins/layer/layer.js'}"></script>
<script src="../../../../static/itsoftui/plugins/icheck/jquery.icheck.min.js" th:src="@{${root}+'/itsoftui/plugins/icheck/jquery.icheck.min.js'}"></script>
<script src="../../../../static/itsoftui/js/itsoftui.js" th:src="@{${root}+'/itsoftui/js/itsoftui.js'}"></script>
<script>
    var datagrid;
    var index=parent.layer.getFrameIndex(window.name);
  $(function () {
    var idList = parent.idList;
    //按钮
    $('#toolBtn').toolbarbtn({
        btn:[
            {
               text:'保存',
               title:'保存',
               icon:'iconfont-save',
               click:function () {
                   addRow()
               }
             }
        ]
    });

    //搜索
    $('#toolSearch').toolbarsearch({
        width:'180px',
        placeholder:'供应商名称',
        searchEvent:function (val) {
           datagrid.refreshData({
               searchValue:val
           })
        }
    })


    //列表
      datagrid=$('#datagrid').datagrid({
        keyField: "id",
        page: false,
        url: '[[${root}]]/api/v2/dining/manage/diningSupplier/warehouseMaterialSupplierSelectList',
        type: 'post',
        line: "both",
        queryParams:{idList:idList},
        isSequence: true,
        singleSelect: false,
        eventrow: false,
        click: function() {

        },
        dblclick: function() {

        },
        loadend: function(queryParams) {
            datagrid.iCheck()
        },
        columns:[
            {
                field:'id',
                isshow:false
            },{
                title: '名称',
                field: 'name',
                align: "left",
                width: '300',
                widthfix:true,
                formatter:function () {
                }
            }
        ]
    });
    datagrid.loadData(0)

//点击确定
      function addRow() {
          var rows=datagrid.getSelectedRows();
          if(rows.length==0){
              parent.ITSOFT.tools.showMsg('error','请选择要添加的行');
              return false
          }
          parent.ITSOFT.dataAjax({
              url: '[[${root}]]/api/v2/dining/manage/diningWarehouseMaterial/saveWarehouseMaterialSupplier',
              type: 'post',
              data: {ids:rows,idList:idList},
              async: false,
              beforeSend: function () {
                  loadingindex = parent.ITSOFT.itWin.msg("正在提交数据",16);
              },
              success: function (data) {
                  parent.ITSOFT.itWin.close(loadingindex);
                  if (data.errorCode == 0) {
                      parent.ITSOFT.tools.showMsg("ok", data.message);
                      parent.datagrid.refreshData();
                      parent.ITSOFT.itWin.close(index);
                  } else {
                      parent.ITSOFT.tools.showMsg("error", data.message);
                      return false;
                  }
              },
              error: function () {
                  parent.ITSOFT.itWin.close(loadingindex);
                  parent.ITSOFT.tools.showMsg("error", data.message);
              },
              complete: function () {
                  parent.ITSOFT.itWin.close(loadingindex);
              }
          });


      }


  })
</script>
</html>