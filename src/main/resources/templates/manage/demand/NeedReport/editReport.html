<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <title>编辑需求上单</title>
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../../../../static/itsoftui/plugins/icheck/icheck.css">
    <link rel="stylesheet" href="../../../../static/common/css/indexBase.css">
    <link rel="stylesheet" type="text/css" href="../../../../static/itsoftui/plugins/pikaday/pikaday.css" />
    <link rel="stylesheet" href="../../../../static/itsoftui/css/itsoftui.css">
    <style>
        .timeBtn span{
            margin-top: 0;
        }
        .table-search-menu{
            width: 660px!important;
        }
        .tip{
            color: #aa1111;
        }
        .actionBtn{
            float: left;
            margin-top: 5px;
        }
        .actionBtn .action{
            width: 120px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            display: inline-block;
            background-color: #edf6ff;
            cursor: pointer;
            margin-right: 10px;

        }
        .actionBtn span{
            color: #2e8ded;
        }
        .itemBtn{
            float: right;
            margin-top: 5px;
        }
        .itemBtn .item{
            display: inline-block;
            width: 80px;
            height: 30px;
            border-radius: 3px;
            text-align: center;
            line-height: 30px;
            background-color:#edf6ff;
            margin-left: 10px;
            cursor: pointer;
        }
        .itemOn{
            background-color: #2e8ded!important;
        }
        .delBtn{
            color: red;
            cursor: pointer;
        }
        .selectrow .delBtn{
            color: #fff;
        }
    </style>
</head>
<body>
<div class="pd-10 wrap">
    <div class="wrap-top">
        <p style="color: #737373;float: left;">需求计划->需求上报->编辑需求单</p>
        <p id="closeBtn" style="float: right;"></p>
    </div>
    <div class="wrap-bd">
        <div class="itsoft-toolbar">
            <div class="actionBtn">
                <div class="action" id="addNewBtn">
                    <img src="../../../../static/common/images/xin.png">
                    <span>新建需求单</span>
                </div>
                <div class="action" id="folderBtn">
                    <img src="../../../../static/common/images/d2.png">
                    <span>从收藏夹导入</span>
                </div>
            </div>
            <div class="itemBtn">
                <div class="item itemOn" id="saveBtn">
                    <img src="../../../../static/common/images/d3.png">
                    <span style="color: #edf6fb">保存</span>
                </div>
                <div class="item" id="reportBtn">
                    <img src="../../../../static/common/images/d4.png">
                    <span style="color:#2e8ded;">上报</span>
                </div>
                <div class="item" id="delBtn">
                    <img src="../../../../static/common/images/d5.png">
                    <span style="color: #fb9c40">删除</span>
                </div>
            </div>
        </div>
        <div class="itsoft-panel">
            <div class="itsoft-panel-form">
                <form id="addform" class="form form-horizontal" action="ajaxOperation.ashx?Action=formUpload" method="post" enctype="multipart/form-data" style="width:740px">
                    <div class=" row form-group">
                        <label class=" col-md-1  control-label" style="width: 80px;">单据号：</label>
                        <div class="col-md-1 " style="width: 200px;">
                            <input type="text" name="gysname" value="XQ20180306" disabled="disabled" class="form-control">
                        </div>

                        <label class="col-md-1 control-label" style="width: 90px;"><em class="tip">*</em>供应时间：</label>
                        <div class="col-md-1" style="width: 385px;">
                            <div class="timeBtn btnop" style="float: left">
                                <span class="yj3" data="1">今天</span>
                                <span class="yj3 on" data="2">明天</span>
                                <span class="yj3" data="3">后天</span>
                            </div>
                            <div style="width: 200px;float: left">
                                <input type="text" id="gyTime" name="gyTime" placeholder="请选择供应时间" class="form-control">
                                <i class="iconfont iconfont-arrow2-bottom" style=" float:right; position: absolute; top:2px;right:20px"></i>
                            </div>
                        </div>
                    </div>
                    <div class=" row form-group">
                        <label class=" col-md-1  control-label" style="width: 80px;"><em class="tip">*</em>库房：</label>
                        <div class="col-md-1 " style="width: 200px;">
                            <div id="wareHouse" class="dropdownlist" name="wareHouse">
                            </div>
                        </div>
                        <label class=" col-md-1  control-label" style="width: 90px;"><em class="tip">*</em>需求单位：</label>
                        <div class="col-md-1 " style="width: 367px;">
                            <div id="demandUnit" class="dropdownlist" name="demandUnit">
                            </div>
                        </div>
                    </div>
                    <div class=" row form-group">
                        <label class=" col-md-1  control-label" style="width: 80px;">备注：</label>
                        <div class="col-md-1 " style="width: 673px;">
                            <input type="text" name="bz" value="123" class="form-control">
                        </div>
                    </div>
                </form>
                <div id="orderlog" style="position: absolute; height: 145px; overflow: auto; right: 2px;
            line-height: 25px; top: 0px; width: 320px;">
                    <p style="margin-top: 5px;">
                        <code>温馨提示:</code></p>
                    <p>
                        1.录入明细前请先选择供应库房;</p>
                    <p>
                        2.带*号项目为必填项目;</p>
                    <p>
                        3.供应时间为要求库房供应的时间；</p>
                    <p>
                        4.上报=保存+上报，需求上报后将不能修改。</p>
                </div>
            </div>
            <div class="itsoft-datagrid" style="border-top: 0">
                <div id="datagrid"></div>
            </div>

        </div>
    </div>
</div>
</body>
<script src="../../../../static/itsoftui/plugins/jquery-1.12.4.js"></script>
<script src="../../../../static/itsoftui/plugins/layer/layer.js"></script>
<script src="../../../../static/itsoftui/plugins/moment.min.js" type="text/javascript"></script>
<script src="../../../../static/itsoftui/plugins/pikaday/pikaday.js" type="text/javascript"></script>
<script src="../../../../static/itsoftui/plugins/icheck/jquery.icheck.min.js"></script>
<script src="../../../../static/itsoftui/js/itsoftui.js"></script>
<script>
    var index=parent.layer.getFrameIndex(window.name);
    var datagrid;
        //关闭按钮
        $('#closeBtn').toolbarbtn({
            btn:[
                {
                    text:'',
                    title:'关闭',
                    width:'35px',
                    icon:'iconfont-close',
                    click:function () {
                        parent.ITSOFT.itWin.close(index);
                    }
                }
            ]
        });
        //库房下拉
        $('#wareHouse').dropdownlist({
            dataurl:'../../../../static/data/select.json',
            placeholder:'请选择库房',
            width:'182px',
            selectText:'101库房',
            changeEvent:function (val,text) {

            }
        });
        //需求单位
        $('#demandUnit').dropdownlist({
            dataurl:'../../../../static/data/select.json',
            placeholder:'请选择需求单位',
            width:'365px',
            allowinput: true,
            selectText:'学子食府',
            changeEvent:function (val,text) {

            }
        });
         //保存
         $('#saveBtn').on('click',function () {
           saveRow()
         });
         //上报
         $('#reportBtn').on('click',function () {
           saveUpRow()
         });
         //删除
         $('#delBtn').on('click',function () {
           delReport()
         });
        //供应时间
        var pickerydrq = new Pikaday({
            field: document.getElementById('gyTime'),
            firstDay: 1,
            format: 'YYYY-MM-DD',
            minDate: ITSOFT.tools.dateCalDay(1, 0), //today
            maxDate: ITSOFT.tools.dateCalDay(1, 30), //30days  后
            yearRange: [2010, 2020]
        });
        //列表
        datagrid = $('#datagrid').datagrid({
            keyField: "orderid",
            page:false,
            url: '../../../../static/data/order.json',
            type: 'GET',
            line: "both",
            isSequence: true,
            singleSelect: true,
            eventrow: false,
            click: function() {

            },
            dblclick: function() {

            },
            columns:[
                {
                    field:'id',
                    isshow:false
                },{
                    title: '<a title="添加行" class="iconfont listbtn addrow iconfont-add"></a>',
                    width: '30',
                    formatter:function () {
                        return '<span class="iconfont iconfont-del2 delBtn" style="font-size: 20px"></span>'
                    }
                },{
                    title: '编码',
                    field: 'state',
                    align: "center",
                    width: '120',
                    formatter:function (val) {
                        return '<input type="text" value="XQ131313" name="coding">'
                    }
                },
                {
                    title: '原料名称',
                    field: 'rawName',
                    align: "center",
                    width: '180',
                    overflow: "visible",
                    formatter:function () {
                        return '<input type="text" name="rawName" data=""  value="菠菜">' +
                            '<a class="iconfont listbtn iconfont-more"></a>' +
                            '<div class="table-search-menu"></div>';
                    }
                },
                {
                    title: '原料类别',
                    field: 'rawType',
                    align: "center",
                    width: '150',
                    formatter:function () {
                        return '蔬菜'
                    }
                },
                {
                    title: '规格',
                    field: 'rawUnit',
                    align: "center",
                    width: '100',
                    formatter:function () {
                        return ''
                    }
                },
                {
                    title: '单位',
                    field: 'rawDw',
                    align: "center",
                    width: '80',
                    formatter:function () {
                        return '斤'
                    }
                },
                {
                    title: '品牌',
                    field: 'rawBrand',
                    align: "center",
                    width: '150',
                    formatter:function () {
                        return ''
                    }
                },
                {
                    title: '需求量',
                    field: 'reportTime',
                    align: "center",
                    width: '70',
                    formatter:function () {
                        return '<input type="text" value="10">'
                    }
                },
              {
                title: '供应价',
                field: 'Dj',
                align: "center",
                width: '80',
                formatter:function () {
                  return '1.5'
                }
              },{
                title: '金额',
                field: 'price',
                align: "center",
                width: '70',
                formatter:function (val) {
                  return '100000'
                }
              },
                {
                    title: '备注',
                    field: 'remark',
                    align: "left",
                    width: '100',
                    widthfix:true,
                    formatter:function () {
                        return '<input type="text" value=" ">'
                    }
                }
            ]
        });
        datagrid.loadData()


        $('.btnop').on('click','span',function () {
            $(this).addClass('on').siblings().removeClass('on')
        });


         //删除行
         $('#datagrid').on('click','.delBtn',function () {
             var elem=$(this);
            ITSOFT.itWin.confirm('确定要删除吗?',function () {
                var row=elem.parents('tr')
                row.fadeTo("slow", 0.02, function() {
                    $(this).slideUp("fast", function() {
                        $(this).remove();
                        datagrid.rowIndex()
                    });
                });
            });
         });
        //点击添加行
        $("#datagrid").on("click", ".addrow", function(e) {
            addrow();
        });

        function  addrow() {
            datagrid.addRow(0, null, null);
            var row = $("#datgrid1 .table-body tr").last();
            $(row).find("input").eq(0).focus();
        }


    //上下键
    $('#datagrid').on('keydown','input',function (e) {
      //38上
      //40下
      //37左
      //39右
      var key=e.keyCode;
//       var index=$("#datagrid input").index(this);
      var index=$(this).parents('tr').find('input').index(this);
      if(key==38){
        $(this).parents('tr').prev('tr').find('input').eq(index).focus()
      }
      if(key==40){
        $(this).parents('tr').next('tr').find('input').eq(index).focus()
      }
      if(key==37){
        index-=1
        $(this).parents('tr').find('input').eq(index).focus()
      }
      if(key==39){
        index+=1
        $(this).parents('tr').find('input').eq(index).focus()
      }
    })


    //input回车搜索
    var isNext=false
    $('#datagrid').on('keydown','input',function (e) {
      var key=e.keyCode;
      if($(this).parent("td").attr("field") == "rawName"){
        var obj = $(this);
        var val=$(this).val();
        var menu = obj.nextAll(".table-search-menu");
        loadSearchData(menu,val)
      }
      if(key==13){
        var nxtIdx = $("#datagrid input").index(this);
        console.log(nxtIdx)
        if($(this).parent("td").attr("field") == "state"){
          if(!getItemCod($(this))) {
            isNext = true
          }else {
            isNext = false
          }
        }else {
          if($(this).parent("td").attr("field") == "rawName"){
            if(!loadSearchData(menu,val)){
              isNext = true
            }else {
              isNext = false
            }
          }else {
            if($("#datagrid").find('input').eq(nxtIdx).val!=''){
              isNext=true
            }else {
              isNext=false
            }
          }

        }
        console.log(isNext)
        if(isNext){
          if($("#datagrid").find('input').eq(nxtIdx).val!=''){
            nxtIdx+=1
            isNext=true
          }else {
            isNext=false
          }
          console.log(nxtIdx)
          $("#datagrid").find('input').eq(nxtIdx).focus();
          var lastrow = $("#datagrid").find('input').length-1;
          var currows = $("#datagrid input").index(this);
          console.log(lastrow,currows)
          if (lastrow == currows) {
            addrow();
            $("#datagrid").find('input').eq(nxtIdx).focus();
          }
        }

      }
    });


    function getItemCod(el) {
      var val=el.val();
      if(val!=""){
        ITSOFT.dataAjax({
          url: '../../../../static/data/material.json',
          type: 'GET',
          async: true,
          beforeSend: function() {},
          success: function(res) {
            if(res.data.total>1){
              var col=res.data.rows[0];
              var row=datagrid.getSelectedRow();
              //材料id
              row.children("td[field='mid']").text(col.id);
              //原料名称
              row.children("td[field='rawName']").children("input").val(col.name);
              //原料类别
              row.children("td[field='rawType']").text(col.spec);
              //规格
              row.children("td[field='rawUnit']").text(col.unit);
              //单位
              row.children("td[field='rawDw']").text(col.unit);
              //品牌
              row.children("td[field='rawBrand']").text(col.unit);
              row.attr("ischange", "1");
            }else {
              ITSOFT.itWin.open({
                title:'选择原料[1，打钩选中原料 2，点确定进行添加 3，可以多选]',
                area:['900px','500px'],
                content:['addReportRow.html','no']
              })
            }
          },
          complete: function() {

          },
          error: function() {
            ITSOFT.tools.showMsg("error", "数据加载失败")
          }
        });
      }else {
        return true
      }
    }
    //名称加载。。。
    function loadSearchData(menu,val) {
      console.log(val)
      if(val!=''){
        $(menu).empty();
        var $loading = $("<div class='loading'>加载中...</div>");
        $(menu).append($loading)
        if (menu.is(":hidden")) {
          $(document).find(".table-search-menu").hide();
          menu.show();
        };
        var queryParams = {
          "kfid": "0",
          "findvalue": val
        };
        //查询数据
        ITSOFT.dataAjax({
          url: '../../../../static/data/material.json',
          type: 'GET',
          async: true,
          data: queryParams,
          beforeSend: function() {},
          success: function(res) {
            if (res.data.total > 0) {
              $.each(res.data.rows, function(i, row) {
                var $table = $("<ul class='table-search'/>");
                //id
                $table.append('<li  field="rawId"  style="display:none">' + row.id + '</li>')
                //原料名称
                $table.append('<li field="rawName" style="width:178px; text-align:left;">' + row.name + '</li>')
                //原料类别
                $table.append('<li field="rawType" style="width:150px">' + row.barcode + '</li>')
                //原料规格
                $table.append('<li field="rawUnit"  style="width:100px">' + row.spec + '</li>')
                //原料单位
                $table.append('<li field="rawDw" style="width:80px">' + row.unit + '</li>')
                //原料品牌
                $table.append('<li field="rawBrand" style="width:150px">' + row.manufacturers + '</li>')
                menu.append($table);
              });
            }
          },
          complete: function() {
            $(menu).find(".loading").remove();
          },
          error: function() {
            ITSOFT.tools.showMsg("error", "数据加载失败")
          }
        });
      }else {
        return true
      }
      $(document).on("click", ".table-search-menu ul", function(e) {
        $(this).siblings().removeClass('currentrow').end().addClass('currentrow');
        var curmenurow = menu.find(".currentrow");
        if (curmenurow.length == 0) return false;
        var cols = '[{';
        curmenurow.find("li").each(function() {
          cols += '"' + $(this).attr("field") + '":"' + $(this).text().trim() + '",';
        });
        cols += '"itsfot":""}]';
        editrow(datagrid.getSelectedRow(), JSON.parse(cols));
        $(this).parents('tr').find('td[field=reportTime]').find('input').focus();
        menu.hide();
      });
      function editrow(row, data) {
        $.each(data, function(i, col) {
          //材料id
          row.children("td[field='mid']").text(col["id"]);
          //原料名称
          row.children("td[field='rawName']").children("input").val(col.rawName);
          //原料类别
          row.children("td[field='rawType']").text(col.rawType);
          //规格
          row.children("td[field='rawUnit']").text(col.rawUnit);
          //单位
          row.children("td[field='rawDw']").text(col.rawDw);
          //品牌
          row.children("td[field='rawBrand']").text(col.rawBrand);
          row.attr("ischange", "1")
        });
      }
    };
    //更多
    $('#datagrid').on('click','.iconfont-more',function () {
      ITSOFT.itWin.open({
        title:'选择原料[1，打钩选中原料 2，点确定进行添加 3，可以多选]',
        area:['900px','500px'],
        content:['addReportRow.html','no']
      })
      $(this).parents('tr').find('td[field=reportTime]').find('input').focus()
    });




//        //编码input搜索
//        $('#datagrid').on('keydown','input[name="coding"]',function (e) {
//            var key=e.keyCode;
//            var val=$(this).val();
//            if(key==13){
//                var queryParams = {
//                    "kfid": "0",
//                    "findvalue": val
//                };
//                //查询数据
//                ITSOFT.dataAjax({
//                    url: '../../../../static/data/material.json',
//                    type: 'GET',
//                    async: true,
//                    data: queryParams,
//                    beforeSend: function() {},
//                    success: function(res) {
//                        if (res.data.length > 0) {
//                            var col=res.data[0];
//                            var row=datagrid.getSelectedRow();
//                            //材料id
//                            row.children("td[field='mid']").text(col.id);
//                            //原料名称
//                            row.children("td[field='rawName']").children("input").val(col.name);
//                            //原料类别
//                            row.children("td[field='rawType']").text(col.spec);
//                            //规格
//                            row.children("td[field='rawUnit']").text(col.unit);
//                            //单位
//                            row.children("td[field='rawDw']").text(col.unit);
//                            //品牌
//                            row.children("td[field='rawBrand']").text(col.unit);
//                            row.attr("ischange", "1")
//                        }
//                    },
//                    complete: function() {
//
//                    },
//                    error: function() {
//                        ITSOFT.tools.showMsg("error", "数据加载失败")
//                    }
//                });
//            }
//        });
//        var  _time;
//        //原料名称查询
//        $('#datagrid').on('keydown','input[name="rawName"]',function () {
//            var obj = $(this);
//            var menu = obj.nextAll(".table-search-menu");
//            clearTimeout(_time);
//            _time = setTimeout(function() {
//                loadSearchData(menu, obj.val().trim());
//            }, 300);
//        });
//
//        function loadSearchData(menu,val) {
//            $(menu).empty();
//            var $loading = $("<div class='loading'>加载中...</div>");
//            $(menu).append($loading)
//            if (menu.is(":hidden")) {
//                $(document).find(".table-search-menu").hide();
//                menu.show();
//            };
//            var queryParams = {
//                "kfid": "0",
//                "findvalue": val
//            };
//            //查询数据
//            ITSOFT.dataAjax({
//                url: '../../../../static/data/material.json',
//                type: 'GET',
//                async: true,
//                data: queryParams,
//                beforeSend: function() {},
//                success: function(res) {
//                    if (res.data.length > 0) {
//                        $.each(res.data, function(i, row) {
//                            var $table = $("<ul class='table-search'/>");
//                            //id
//                            $table.append('<li  field="rawId"  style="display:none">' + row["id"] + '</li>')
//                            //原料名称
//                            $table.append('<li field="rawName" style="width:178px; text-align:left;"  >' + row["name"] + '</li>')
//                            //原料类别
//                            $table.append('<li field="rawType" style="width:150px"  >' + row["barcode"] + '</li>')
//                            //原料规格
//                            $table.append('<li field="rawUnit"  style="width:100px"  >' + row["spec"] + '</li>')
//                            //原料单位
//                            $table.append('<li field="rawDw" style="width:80px"  >' + row["unit"] + '</li>')
//                            //原料品牌
//                            $table.append('<li field="rawBrand" style="width:150px"  >' + row["manufacturers"] + '</li>')
//                            menu.append($table);
//                        });
//                    }
//                },
//                complete: function() {
//                    $(menu).find(".loading").remove();
//                },
//                error: function() {
//                    ITSOFT.tools.showMsg("error", "数据加载失败")
//                }
//            });
//            $(document).on("click", ".table-search-menu ul", function(e) {
//                $(this).siblings().removeClass('currentrow').end().addClass('currentrow');
//                var curmenurow = menu.find(".currentrow");
//                if (curmenurow.length == 0) return false;
//                var cols = '[{';
//                curmenurow.find("li").each(function() {
//                    cols += '"' + $(this).attr("field") + '":"' + $(this).text().trim() + '",';
//                });
//                cols += '"itsfot":""}]';
//                editrow(datagrid.getSelectedRow(), JSON.parse(cols));
//                menu.hide();
//            });
//            function editrow(row, data) {
//                console.log(data)
//                $.each(data, function(i, col) {
//                    //材料id
//                    row.children("td[field='mid']").text(col["id"]);
//                    //原料名称
//                    row.children("td[field='rawName']").children("input").val(col.rawName);
//                    //原料类别
//                    row.children("td[field='rawType']").text(col.rawType);
//                    //规格
//                    row.children("td[field='rawUnit']").text(col.rawUnit);
//                    //单位
//                    row.children("td[field='rawDw']").text(col.rawDw);
//                    //品牌
//                    row.children("td[field='rawBrand']").text(col.rawBrand);
//                    row.attr("ischange", "1")
//                });
//
//            }
//
//        };
//        //更多
//        $('#datagrid').on('click','.iconfont-more',function () {
//            ITSOFT.itWin.open({
//                title:'选择原料[1，打钩选中原料 2，点确定进行添加 3，可以多选]',
//                area:['900px','500px'],
//                content:['addReportDetails.html','no']
//            })
//        });

      //保存
      function saveRow() {
        ITSOFT.itWin.open({
          title:'收藏',
          area:['350px','240px'],
          content:['saveRow.html','no']
        })
      }
      //上报
      function saveUpRow() {
        ITSOFT.itWin.open({
          title:'上报',
          area:['350px','240px'],
          content:['saveRow.html','no']
        })
      }
      //收藏夹导入
      function favoriteRows() {
        if(warehouse!=''){
          ITSOFT.itWin.open({
            full:true,
            content:['favorites.html','no'],
            closeBtn:0
          })
        }else {
          ITSOFT.tools.showMsg('error','请先选择库房')
        }

      };
      getRowTime(2)
      function getRowTime(key) {
        var t=new Date();
        var y=t.getFullYear();
        var m=parseInt(t.getMonth()+1);
        var d=parseInt(t.getDate());
        var nt='';
        if(m<10){
          m='0'+m
        }

        if(key==1){
          if(d<10){
            d='0'+d
          }
          nt=y+'-'+m+'-'+d
        }
        if(key==2) {
          d+=1;
          if(d<10){
            d='0'+d
          }
          nt=y+'-'+m+'-'+d
        }
        if(key==3) {
          d+=2
          if(d<10){
            d='0'+d
          }
          nt=y+'-'+m+'-'+d
        }
        $('#gyTime').val(nt)
      }

      //删除需求单
      function delReport() {
        var msg='确定要删除需求单？'
        ITSOFT.itWin.confirm(msg,function () {
          parent.ITSOFT.tools.showMsg('ok','删除成功')
          parent.ITSOFT.itWin.close(index)
        })
      }
    function insertrow(data) {
        var currentrow = datagrid.getSelectedRow(); //当前行
        $.each(data, function(i, col) {
            if (i == 0) {
                //材料id
                currentrow.children("td[field='mid']").text(col["mid"]);
                //材料名称
                currentrow.children("td[field='mname']").children("input").val(col["mname"]);
                //这句话目的为了验证输入的值和选中的值
                currentrow.children("td[field='mname']").children("input").attr("data", col["mname"]);
                //材料国际码
                currentrow.children("td[field='mbarcode']").text(col["mbarcode"]);
                //材料规格
                currentrow.children("td[field='mspec']").text(col["mspec"]);
                //材料单位
                currentrow.children("td[field='munit']").text(col["munit"]);
                //材料厂家
                currentrow.children("td[field='mmanufacturers']").text(col["mmanufacturers"]);
                currentrow.attr("ischange", "1")
            } else {
                var newdata = {
                    'orderid': '0'
                }; //orderid 合并进去
                $.extend(true, col, newdata);
                currentrow = datagrid.addRow(0, null, col,currentrow);
                currentrow.attr("ischange", "1");
            }
        });
    }

    function closeIndex() {
      parent.ITSOFT.itWin.close(index)
    }
    function newIndex() {
      $('#datagrid').find('.table-body').empty()
    }


</script>
</html>